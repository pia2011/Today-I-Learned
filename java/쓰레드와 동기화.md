# 쓰레드와 동기화에 대한 정리

스프링을 통해 웹 개발을 하다보니, 스레드와 동기화에 대한 정리가 한번 더 필요하다고 느꼈기 때문에 정리함

## 프로세스와 스레드

### 프로세스
> 실행중인 프로그램

즉, 프로그램이 실행에 필요한 자원을 OS로 부터 할당받은 것

모든 프로세스는 최소 하나 이상의 쓰레드가 존재하며 둘 이상의 쓰레드를 가진 프로세스를 멀티쓰레드 프로세스라고 한다.

### 멀티 쓰레딩
> 하나의 프로세스 내에서 여러 쓰레드가 동시에 작업을 수행하는 것.. 처럼 보이지만 실제로는 CPU 코어 개수만큼
> 동시 작업 수행이 제한된다. 즉 아주 빠르게 번갈아 수행하기 때문에 동시에 수행되는 것 처럼 보이는 것 (시분할)


### 멀티 쓰레딩 장점

1. CPU 사용률 향상
2. 자원을 보다 효율적으로 사용
3. 사용자에 대한 응답성이 향상
4. 작업이 분리되어 코드가 간결해짐

### 멀티 쓰레딩 단점

1. 동기화 문제 가능성
2. 교착상태 가능성

> 프로세스 내에서 자원을 공유하면서 작업을 진행하기 때문에 동기화(Syncronization) 및 교착상태(deadLock)가 발생할 수 있음

### 멀티 프로세싱 & 멀티 쓰레딩 비교 with JVM

#### 멀티 프로세싱
![image](https://github.com/pia2011/Today-I-Learned/assets/53935439/bea80d30-464d-4fb2-be98-4105c4c6714a)

멀티 프로세싱은 완전히 독립된 메모리 공간을 할당 받아 실행되기 때문에
동기화 문제나 교착 상태 문제가 발생할 여지가 없다. 또한 하나의 프로세스가 죽더라도
다른 프로세스에 영향을 주지 않기 때문에 안정성이 높다. 

하지만, 프로세스간 IPC 비용이 발생하며 멀티 스레드 방식보다 많은 메모리 공간이 필요하고 `Context Switching` 이 
자주 일어나는 경우 오버헤드가 발생하여 성능 저하가 일어날 수 있다.

> 컨택스트 스위칭이란, CPU 는 한번에 하나의 프로세스만 실행 가능한데 CPU 에서 여러 
> 프로세스를 돌아가며 작업을 처리하는 것을 Context Switching 이라고 부른다.
> 

#### 멀티 쓰레딩
![image](https://github.com/pia2011/Today-I-Learned/assets/53935439/013edcf0-bbe4-4777-aea9-569300165681)

멀티 쓰레딩은 하나의 프로세스 내에서 여러개의 쓰레드를 두고 실행하며
method 영역, heap 영역을 공유하기 때문에 동기화 문제가 발생할 수 있지만
여러개의 프로세스를 두어 실행하는 것 보다는 메모리 공간을 절약할 수 있다.

---

## 주의해야할 점

주의할 것은 단순히 CPU 만을 사용하는 계산 작업이라면 쓰레드간 context switching 에도 
다음 실행할 위치 등의 정보를 저장하고 읽어 오는 시간이 소요되므로 싱글 스레드보다
멀티 스레드로 처리한 작업이 더 늦을 수도 있다.

또 멀티 스레드라고 해도 싱글 코어인 경우 하나의 코어가 번갈아가며 작업을 처리해야 하기 때문에
두 작업이 겹치지 않는다.

--- 

### 데몬 스레드

데몬 쓰레드는 다른 일반 스레드의 작업을 돕는 보조적인 역할을 수행한다.


# 참고

쉽게 배우는 운영체제
https://www.youtube.com/watch?v=eELCTRdSj7o

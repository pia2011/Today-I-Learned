## 웹 어플리케이션 이해

Web은 HTTP를 이용해서 통신한다.

![image](https://user-images.githubusercontent.com/53935439/155117585-75a95d90-c586-430f-a0e7-a84fb27eec0c.png)

HTTP 메시지에 모든 것을 전송한다.
* HTML, TEXT
* IMAGE, 음성, 영상, 파일
* JSON, XML(API)
* 거의 모든 형태의 데이터 전송 가능
* 서버간에 데이터를 주고 받을 떄도 대부분 HTTP를 사용한다.

### 웹 서버

![image](https://user-images.githubusercontent.com/53935439/155117868-243c6183-d073-4b12-bb71-04e6e45548d2.png)

### 웹 애플리케이션 서버(WAS)

![image](https://user-images.githubusercontent.com/53935439/155117917-9aa549b5-481c-4cce-8f2f-facb471e34c4.png)

### 차이점

웹 서버는 정적 리소스를 제공하는 반면에 WAS는 프로그램을 실행시켜 로직을 수행하기 떄문에 정적 리소스 뿐만 아니라 동적 리소스 또한 제공 가능하다.

사실 둘의 용어만큼이나 경계도 모호한데 웹 서버도 프로그램을 실행하는 기능을 포함하기도 하고 WAS도 웹 서버의 기능을 제공하기 떄문이다.

따라서 WAS는 애플리케이션 코드를 실행하는데 좀 더 특화되어 있다고 이해하면 알맞다.

### 웹 시스템 구성

WAS와 DB만으로도 시스템을 구성할 수 있다.

![image](https://user-images.githubusercontent.com/53935439/155119473-7413c4d4-cf1f-40d8-92e7-3c3cc2c1c73b.png)

하지만 다음의 몇 가지 이유로 인해 제약이 발생한다.

![image](https://user-images.githubusercontent.com/53935439/155119509-50ce8b93-75cd-463d-8420-e9ee8cc8dc98.png)

* WAS가 너무 많은 역할을 담당하면 서버의 과부하가 발생할 수 있다.
* WAS 장애시 오류 화면도 노출이 불가능하다.
* 가장 비싼 애플리케이션 로직이 정적 리소스 때문에 수행이 어려울 수 있다.

따라서 대부분 아래와 같이 WEB, WAS, DB를 사용해서 웹 시스템을 구성하게 된다.

![image](https://user-images.githubusercontent.com/53935439/155119770-11965182-5563-44ac-af23-d5a2f112aca8.png)

* 정적 리소스는 웹 서버가 처리
* 웹 서버는 애플리케이션 로직과 같은 동적인 처리가 필요하면 WAS에 요청을 위임
* WAS는 중요한 애플리케이션 로직 처리를 전담

이렇게 역할을 나누어 처리를 하면 효율적인 리소스 관리가 가능하다.

![image](https://user-images.githubusercontent.com/53935439/155120161-56830bc7-46ab-4a9c-ac34-b59050dcf613.png)

* 정적 리소스가 많이 사용되면 WEB서버 증설
* 애플리케이션 리소스가 많이 사용되면 WAS 증설

또한 이렇게 나누어 처리를 하게 되면 WAS 장애시 WEB 서버가 오류 화면을 제공할 수 있게 된다.

![image](https://user-images.githubusercontent.com/53935439/155120287-e449a2ac-0521-4f73-899c-41ea653cd204.png)

```
WAS는 여러가지 이유(DB오류, 로직 오류 등)로 잘 죽지만, WEB서버는 단순해서 잘 안죽는다.
```

물론 API로 DATA만 제공할 때에는 웹 서버가 필요하지 않을 수 있다.

### 서블릿

HTTP를 이용해서 통신을 진행하려면 다음과 같은 절차가 필요하다.

![image](https://user-images.githubusercontent.com/53935439/155122179-490a42f3-802b-4517-bffe-161644d172ba.png)

부가적으로 처리해야 할 일들이 너무나도 많기 떄문에 가장 의미있다고 볼 수 있는 로직에 집중하기 힘들다.

하지만 서블릿을 지원하는 WAS를 사용하면 로직에 집중해서 개발 할 수 있다. 나머지 부가적인 일들은 서블릿이 제공하는 기능을 통해 쉽게 처리할 수 있다.

즉, 서블릿(을 지원하는 WAS)을 사용하면 개발자는 HTTP 스펙을 매우 편리하게 사용할 수 있다.

![image](https://user-images.githubusercontent.com/53935439/155122730-c6776780-0dd4-4082-891b-3d98516928e6.png)

HTTP 요청이 오면 WAS는 Request, Response 객체를 새로 만들어서 서블릿 객체를 호출하고 개발자는 객체에 저장된 HTTP 요청 정보를 편리하게 꺼내서 사용하고
다시 알맞은 처리 후 HTTP 응답 정보를 Response 객체에 담아준다. WAS는 객체에 담긴 내용으로 HTTP 응답 정보를 생성해서 보내준다.

### 서블릿 컨테이너

톰캣처럼 서블릿을 지원하는 WAS를 서블릿 컨테이너라고 한다. 서블릿 컨테이너는 서블릿 객체의 생명주기를 관리학고 서블릿 객체는 싱글톤으로 관리한다.
서블릿 객체를 싱글톤으로 관리하는 이유는 다음과 같다.

* 요청이 올 때 마다 계속 객체를 생성하는 것을 비효율적이다.
* 따라서 최초 로딩 시점에 서블릿 객체를 미리 만들어두고 재활용한다.
* 모든 고객의 요청은 동일한 서블릿 객체 인스턴스에 접근하기 때문에 공유 변수 사용에 주의를 요한다.
* 동시 요청을 위한 멀티 쓰레드 처리를 지원한다!
* 서블릿 컨테이너 종료시 함께 종료 된다.

```
물론 request, response 객체들은 항상 요청이 올 때마다 새로 생성한다. 
```

### 멀티 쓰레드 - 동시 요청

쓰레드는 애플리케이션 코드를 하나하나 순차적으로 실행한다. 예를 들어 자바 메인 메서드를 처음 실행하면 main이라는 이름의 쓰레드가 실행되는 것이다. 즉,
쓰레드가 없다면 자바 애플리케이션 실행이 불가능하다. 그런데 쓰레드는 한번에 하나의 코드라인만 수행하기 때문에 동시 처리가 필요하면 쓰레드를 추가로 생성해야 한다.

다중 요청 시 쓰레드 하나만 사용하는 경우 아래와 같이 먼저 들어간 요청에서 문제가 발생할 경우 이후 요청에 영향이 가게 된다.

![image](https://user-images.githubusercontent.com/53935439/155137398-9c29eeac-fe61-41bc-b6cf-fa6c340e52c3.png)

따라서 다음과 같이 요청마다 쓰레드를 생성해주면 문제를 해결해줄 수 있다. 하지만

![image](https://user-images.githubusercontent.com/53935439/155137618-0b3255d5-7f61-482a-93fc-18fd99f4f46d.png)

요청마다 쓰레드를 생성해주면 다음과 같은 장단점이 발생하게 된다.

장점
* 동시 요청을 처리할 수 있다.
* 리소스가 허용할 때까지 처리가 가능하다.
* 하나의 쓰레드가 지연되어도, 나머지 쓰레드는 정상 동작한다.

단점
* 쓰레드 생성 비용은 매우 비싸다. (요청 마다 생성하면, 응답 속도가 늦어진다.)
* 쓰레드는 컨텍스 스위칭 비용이 발생한다.
* 쓰레드 생성에 제한이 없기 때문에 임계점을 넘으면 서버가 죽을 수 있다.

따라서 쓰레드를 요청마다 생성할 때 방생하는 단점들을 해결하기 위해 쓰레드 풀(Thread Pool)이란 기술을 사용한다.

### 쓰레드 풀

![image](https://user-images.githubusercontent.com/53935439/155138746-1f44de93-549b-4636-a109-74a7cda272ce.png)

필요한 쓰레드를 쓰레드 풀에 넣고 관리한다. 쓰레드 풀에는 가능한 쓰레드의 최대치를 관리한다.(톰캣은 기본 200개가 설정되어 있다. 물론 변경 가능하다.)
쓰레드가 필요하면 이미 생성되어 있는 쓰레드를 가져다가 사용하고 종료시 반납한다. 만일 최대 쓰레드가 모두 사용중이면 거절 혹은 대기하도록 설정할 수 있다.

쓰레드 풀을 사용하면 다음과 같은 장점이 있다.
* 쓰레드가 미리 생성되어 있으므로, 쓰레드를 생성하고 종료하는 비용이 절약되고 응답 시간이 빠르다.
* 너무 많은 요청이 들어와도 제한이 있기 때문에 기존 요청은 안전하게 처리할 수 있다.

물론 쓰레드 풀을 사용할 때 주의해야 할 것들은 존재한다. WAS 주요 튜닝 포인트는 최대 쓰레드 수이다.

쓰레드 풀을 너무 낮게 설정하는 경우 CPU가 더 많은 처리를 할 수 있음에도 성능에 제약이 발생한다.

![image](https://user-images.githubusercontent.com/53935439/155139482-b40697dd-649d-4cb9-8b8a-0a2ad48ec8a3.png)

쓰레드 풀을 너무 높게 설정하는 경우 임계점 초과로 서버가 다운된다.

따라서 적정한 수의 쓰레드 풀을 설정해야 하는데.. 로직의 복잡도, CPU, 메모리, IO리소스 상황에 따라 모두 다르기 때문에
성능 테스트를 통해서 알아보고 툴(아파치 ab, 제이미터, nGrinder)을 통해서 적절히 설정해야 한다.

### 중간 정리

멀티 쓰레드에 대한 부분은 WAS가 처리해주기 때문에 개발자는 멀티 쓰레드 관련 코드를 신경쓰지 않아도 되므로 편리하게 소스 코드를 개발하면 된다.

하지만 멀티 쓰레드 환경이므로 싱글톤 객체(서블릿, 스프링 빈)는 주의해서 사용해야 한다.

```
예를 들어 공유 변수같은 경우도 알맞게 설정해주어야 오류가 발생하지 않는다.
```

BE 개발자가 서비스 제공 방식에 대해 고민해야하는 것은 크게 세 가지가 있다.

* 정적 리소스

![image](https://user-images.githubusercontent.com/53935439/155144263-1d98c6ec-b9f2-4279-80c4-a9305efa977a.png)

* 동적 리소스

![image](https://user-images.githubusercontent.com/53935439/155144300-2cd9369d-5029-40af-bf6d-55c46ef442d2.png)

* HTTP API

![image](https://user-images.githubusercontent.com/53935439/155144363-b583ebe3-83f0-49e4-9f82-bcfb78113323.png)

### SSR - 서버 사이드 렌더링

서버에서 최종 HTML을 생성해서 클라이언트에 전달하는 것을 말한다.

![image](https://user-images.githubusercontent.com/53935439/155145945-0cbef1f9-c938-4f68-9d7c-f63d1fe1c52d.png)

* 화면이 정적이로 복잡하지 않을 때 사용한다.
* 백앤드 개발자는 SSR 기술 학습이 필수다.
* JSP, 타입리프(Spring이 밀고 있음)

### CSR - 클라이언트 사이드 렌더링

HTML 결과를 자바스크립트를 사용해 웹 브라우저에서 동적으로 생성해서 적용하는 것을 말한다.

![image](https://user-images.githubusercontent.com/53935439/155145975-d7ac3504-60cd-48fc-b0f0-fc4964e72a08.png)

* 복잡하고 동적인 UI 사용
* FE 전문 분야
* React(점유율 높음), Vue.js
